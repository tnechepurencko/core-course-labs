# Task 1

New application logic:

```
def update_number():
    f = open('visits/visits.txt', 'r+', encoding="utf-8")
    lines = f.readlines()
    if len(lines) > 0:
        num = int(lines[0]) + 1
    else:
        num = 1

    f.seek(0)
    f.truncate()
    f.write(str(num))
    f.close()

    return str(num)
```
```
@app.route('/visits')
def get_visits():
    return update_number()
```
```
@app.route('/')
def get_moscow_time():
    update_number()

    moscow_time = datetime.now(pytz.timezone(TIMEZONE))
    formatted_time = moscow_time.strftime(DATETIME_FORMAT)
    return formatted_time
```
New volume in Dockerfile:
```
VOLUME ["./visits", "./visits"]
```
![img_1.png](..%2Fapp_python%2Fimg_1.png)

# Task 2

# Commands:
- ```helm install web . --values values.yaml```
  ```
  NAME: web
  LAST DEPLOYED: Fri Dec  8 21:37:51 2023
  NAMESPACE: default
  STATUS: deployed
  REVISION: 1
  NOTES:
  1. Get the application URL by running these commands:
    export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=lab10chart,app.kubernetes.io/instance=web" -o jsonpath="{.items[0].metadata.name}")
    export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
    echo "Visit http://127.0.0.1:8080 to use your application"
    kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT

  ```
- ```kubectl get configmap```
  ```
  NAME               DATA   AGE
  config-map         1      10d
  config-map-1       1      106s
  kube-root-ca.crt   1      24d
  ```
- ```kubectl get po```
  ```
  NAME               READY   STATUS    RESTARTS      AGE
  lab10chart-0       1/1     Running   1 (10d ago)   10d
  web-lab10chart-0   1/1     Running   0             3m20s
  ```
- ```kubectl exec lab10chart-8f42fb7d66-8zy65 -- cat /config.json```
  ```
    {
      "key": "mykey"
    }
  ```
