# Commands output:

- ```helm install --dry-run --debug lab10chart ./lab10chart```

    ```
    install.go:192: [debug] Original chart version: ""
    install.go:209: [debug] CHART PATH: /home/tatiana/PycharmProjects/core-course-labs/k8s/lab10chart
    
    NAME: lab10chart
    LAST DEPLOYED: Tue Nov 28 17:50:14 2023
    NAMESPACE: default
    STATUS: pending-install
    REVISION: 1
    USER-SUPPLIED VALUES:
    {}
    
    COMPUTED VALUES:
    affinity: {}
    autoscaling:
      enabled: false
      maxReplicas: 100
      minReplicas: 1
      targetCPUUtilizationPercentage: 80
    fullnameOverride: ""
    image:
      pullPolicy: IfNotPresent
      repository: tnechepurencko/my_app
      tag: latest
    imagePullSecrets: []
    ingress:
      annotations: {}
      className: ""
      enabled: false
      hosts:
      - host: chart-example.local
        paths:
        - path: /
          pathType: ImplementationSpecific
      tls: []
    nameOverride: ""
    nodeSelector: {}
    podAnnotations:
      vault.hashicorp.com/agent-inject: "true"
      vault.hashicorp.com/agent-inject-secret-database-config.txt: internal/data/database/config
      vault.hashicorp.com/role: internal-app
    podSecurityContext: {}
    replicaCount: 1
    resources: {}
    securityContext: {}
    service:
      port: 5000
      type: ClusterIP
    serviceAccount:
      annotations: {}
      create: true
      name: ""
    tolerations: []
    volumeMounts:
    - mountPath: /config.json
      name: config-volume
      subPath: config.json
    volumes:
    - configMap:
        name: config-map
      name: config-volume
    
    HOOKS:
    ---
    # Source: lab10chart/templates/post-install-hook.yaml
    apiVersion: v1
    kind: Pod
    metadata:
       name: postinstall-hook
       annotations:
           "helm.sh/hook": "post-install"
           "helm.sh/hook-delete-policy": hook-succeeded
    spec:
      containers:
      - name: post-install-container
        image: busybox
        imagePullPolicy: Always
        command: ['sh', '-c', 'echo The post-install hook is running && sleep 15' ]
      restartPolicy: Never
      terminationGracePeriodSeconds: 0
    ---
    # Source: lab10chart/templates/pre-install-hook.yaml
    apiVersion: v1
    kind: Pod
    metadata:
       name: preinstall-hook
       annotations:
           "helm.sh/hook": "pre-install"
           "helm.sh/hook-delete-policy": hook-succeeded
    spec:
      containers:
      - name: pre-install-container
        image: busybox
        imagePullPolicy: IfNotPresent
        command: ['sh', '-c', 'echo The pre-install hook is running && sleep 20' ]
      restartPolicy: Never
      terminationGracePeriodSeconds: 0
    ---
    # Source: lab10chart/templates/tests/test-connection.yaml
    apiVersion: v1
    kind: Pod
    metadata:
      name: "lab10chart-test-connection"
      labels:
        helm.sh/chart: lab10chart-0.1.0
        app.kubernetes.io/name: lab10chart
        app.kubernetes.io/instance: lab10chart
        app.kubernetes.io/version: "1.16.0"
        app.kubernetes.io/managed-by: Helm
      annotations:
        "helm.sh/hook": test
    spec:
      containers:
        - name: wget
          image: busybox
          command: ['wget']
          args: ['lab10chart:5000']
      restartPolicy: Never
    MANIFEST:
    ---
    # Source: lab10chart/templates/serviceaccount.yaml
    apiVersion: v1
    kind: ServiceAccount
    metadata:
      name: lab10chart
      labels:
        helm.sh/chart: lab10chart-0.1.0
        app.kubernetes.io/name: lab10chart
        app.kubernetes.io/instance: lab10chart
        app.kubernetes.io/version: "1.16.0"
        app.kubernetes.io/managed-by: Helm
    ---
    # Source: lab10chart/templates/secrets.yaml
    apiVersion: v1
    data:
      password: UyFCXCpkJHpEc2I9
      username: YWRtaW4=
    kind: Secret
    metadata:
      name: db-user-pass
      namespace: default
    type: Opaque
    ---
    # Source: lab10chart/templates/config-map.yaml
    apiVersion: v1
    kind: ConfigMap
    metadata:
      name: config-map
    data:
      config.json: |-
    ---
    # Source: lab10chart/templates/service.yaml
    apiVersion: v1
    kind: Service
    metadata:
      name: lab10chart
      labels:
        helm.sh/chart: lab10chart-0.1.0
        app.kubernetes.io/name: lab10chart
        app.kubernetes.io/instance: lab10chart
        app.kubernetes.io/version: "1.16.0"
        app.kubernetes.io/managed-by: Helm
    spec:
      type: ClusterIP
      ports:
        - port: 5000
          targetPort: http
          protocol: TCP
          name: http
      selector:
        app.kubernetes.io/name: lab10chart
        app.kubernetes.io/instance: lab10chart
    ---
    # Source: lab10chart/templates/statefulset.yaml
    apiVersion: apps/v1
    kind: StatefulSet
    metadata:
      name: lab10chart
      labels:
        helm.sh/chart: lab10chart-0.1.0
        app.kubernetes.io/name: lab10chart
        app.kubernetes.io/instance: lab10chart
        app.kubernetes.io/version: "1.16.0"
        app.kubernetes.io/managed-by: Helm
    spec:
      replicas: 1
      selector:
        matchLabels:
          app.kubernetes.io/name: lab10chart
          app.kubernetes.io/instance: lab10chart
      template:
        metadata:
          annotations:
            vault.hashicorp.com/agent-inject: "true"
            vault.hashicorp.com/agent-inject-secret-database-config.txt: internal/data/database/config
            vault.hashicorp.com/role: internal-app
          labels:
            app.kubernetes.io/name: lab10chart
            app.kubernetes.io/instance: lab10chart
        spec:
          serviceAccountName: lab10chart
          securityContext:
            {}
          containers:
            - name: lab10chart
              securityContext:
                {}
              image: "tnechepurencko/my_app:latest"
              imagePullPolicy: IfNotPresent
              ports:
                - name: http
                  containerPort: 5000
                  protocol: TCP
              env:
                - name: MY_PASSWORD
                  valueFrom:
                    secretKeyRef:
                      name: db-user-pass
                      key: password
              livenessProbe:
                httpGet:
                  path: /
                  port: http
              readinessProbe:
                httpGet:
                  path: /
                  port: http
              resources:
                {}
    
    NOTES:
    1. Get the application URL by running these commands:
      export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=lab10chart,app.kubernetes.io/instance=lab10chart" -o jsonpath="{.items[0].metadata.name}")
      export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
      echo "Visit http://127.0.0.1:8080 to use your application"
      kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT
    ```
- ```kubectl get po,sts,svc,pvc```
  ```
  NAME               READY   STATUS    RESTARTS   AGE
  pod/lab10chart-0   1/1     Running   0          33s
  pod/lab10chart-1   1/1     Running   0          33s
  pod/lab10chart-2   1/1     Running   0          33s
  
  NAME                          READY   AGE
  statefulset.apps/lab10chart   3/3     33s
  
  NAME                               TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE
  service/kubernetes                 ClusterIP   10.96.0.1        <none>        443/TCP             14d
  service/lab10chart                 ClusterIP   10.102.94.107    <none>        5000/TCP            33s
  service/vault                      ClusterIP   10.106.255.229   <none>        8200/TCP,8201/TCP   13d
  service/vault-agent-injector-svc   ClusterIP   10.100.169.113   <none>        443/TCP             13d
  service/vault-internal             ClusterIP   None             <none>        8200/TCP,8201/TCP   13d
  ```
- ```kubectl exec lab10chart-0 -- cat visits/visits.txt```
  ```
  13
  ```
- ```kubectl exec lab10chart-0 -- cat visits/visits.txt```
  ```
  16
  ```
- ```kubectl exec lab10chart-0 -- cat visits/visits.txt```
  ```
  13
  ```
  Each container has its own isolated filesystem, so the results of the command may be different
- ```minikube service lab10chart```
  ```
  |-----------|------------|-------------|---------------------------|
  | NAMESPACE |    NAME    | TARGET PORT |            URL            |
  |-----------|------------|-------------|---------------------------|
  | default   | lab10chart | http/5000   | http://192.168.49.2:30731 |
  |-----------|------------|-------------|---------------------------|
  ðŸŽ‰  Opening service default/lab10chart in default browser...
  ```
  
# Answers:

- Explain why ordering guarantees are unnecessary for your app.
  - The components of the app are completely separate, so ordering will not affect the work of the application in any way. 
  - Example: the ordering made sense, when we were launching grafana depending on loki.
- Implement a way to instruct the StatefulSet controller to launch or terminate all Pods in parallel.
  - A new line in ```statefulset.yaml```: ```podManagementPolicy: Parallel```